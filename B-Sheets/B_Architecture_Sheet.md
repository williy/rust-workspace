# NWMA 2026: B-Sheet (Architecture Sheet) - wp-rust-tool

## 1. 構成識別 (B-00x)

| ID | 項目 | 内容 |
| --- | --- | --- |
| **B-001** | アーキテクチャ名 | **Secure Asset Extraction (SAE)** |
| **B-002** | 開発言語 / 環境 | Rust 2021 Edition / WSL2 (Ubuntu) |
| **B-003** | 主要依存クレート | `regex`, `aes-gcm`, `rand` |

---

## 2. 処理構造定義 (B-10x)

### B-101 モジュール構造（情報の循環）

1. **Extraction (抽出層)**: `regex` を用いて、サーバー内部の `wp-config.php` から平文の機密情報を特定する。
2. **Security (秘匿層)**: `AES-256-GCM` 方式を採用。抽出された資産を暗号化し、可読性を剥奪する。
3. **Persistence (永続層)**: 暗号化されたバイナリと復号用ナンス（Nonce）を `db_pass.enc` へ統合保存する。
4. **Verification (検証層)**: 保存されたバイナリから資産を復元し、整合性を担保する（Phase 3）。

---

## 3. ロジック設計 (B-20x)

### B-201 暗号化アルゴリズム

* **方式**: AES-256-GCM
* **理由**: 現代の暗号基準に準拠。データの「秘匿性」に加え、1ビットの改ざんも許さない「整合性」を同時に確保するため。

### B-202 永続化データフォーマット

保存ファイル (`db_pass.enc`) は以下のバイナリ構造を持つ。

* **[0x00 - 0x0B] (12 bytes)**: Nonce（ナンス）。暗号化ごとに生成される一回限りの使い捨て値。
* **[0x0C - 末尾]**: Ciphertext（暗号文）。

---

## 4. 運用上の制約と道理 (B-30x)

### B-301 鍵管理 (Key Management)

* **現状**: プロトタイプとして32バイトの固定鍵をバイナリに内蔵。
* **次期要件**: 鍵を環境変数（`ENV`）へ逃がすことで、ソースコードと秘密情報を物理的に分離する。

### B-302 実行環境とセキュリティ境界（重要）

* **前提条件**: 本ツールはサーバー内部からの直接アクセス（File System Access）を前提とする。
* **道理**: 通常、`wp-config.php` は Web サーバー（Apache/Nginx）経由では「PHPとして実行」されるため、ブラウザからソースコード（平文）を読み取ることは不可能である。
* **本ツールの役割**: 管理者が SSH 等でサーバー内部に立ち入った際、資産を「平文ファイル」という無防備な状態から、「暗号化された隔離ファイル」へと昇華させるためのものである。

---
